generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                String             @id @default(cuid())
  email             String             @unique
  passwordHash      String
  name              String?
  avatarUrl         String?
  role              Role               @relation(fields: [roleId], references: [id])
  roleId            String
  sessions          Session[]
  prayerSettings    PrayerSettings?
  bookmarks         QuranBookmark[]
  tasbihSessions    TasbihSession[]
  wazifas           Wazifa[]
  lazims            Lazim[]
  journalEntries    JournalEntry[]
  posts             Post[]
  comments          Comment[]
  likes             Like[]
  chatRooms         ChatRoomMember[]
  messages          Message[]
  donations         Donation[]
  tickets           SupportTicket[]
  auditLogs         AuditLog[]
  notificationUsers NotificationUser[]
  groupMemberships  UserGroupMember[]
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
}

model Role {
  id    String @id @default(cuid())
  name  String @unique
  users User[]
}

model Session {
  id           String   @id @default(cuid())
  user         User     @relation(fields: [userId], references: [id])
  userId       String
  refreshToken String   @unique
  expiresAt    DateTime
  createdAt    DateTime @default(now())
}

model PrayerSettings {
  id                 String   @id @default(cuid())
  user               User     @relation(fields: [userId], references: [id])
  userId             String   @unique
  calculationMethod  String
  madhab             String
  latitudeAdjustment String
  notificationsOn    Boolean  @default(true)
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
}

model DuaCategory {
  id   String @id @default(cuid())
  name String
  duas Dua[]
}

model Dua {
  id          String       @id @default(cuid())
  title       String
  arabic      String
  translation String
  reference   String?
  category    DuaCategory? @relation(fields: [categoryId], references: [id])
  categoryId  String?
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
}

model QuranBookmark {
  id        String   @id @default(cuid())
  user      User     @relation(fields: [userId], references: [id])
  userId    String
  surah     Int
  ayah      Int
  juz       Int?
  note      String?
  createdAt DateTime @default(now())
}

model TasbihSession {
  id        String   @id @default(cuid())
  user      User     @relation(fields: [userId], references: [id])
  userId    String
  phrase    String
  target    Int?
  count     Int      @default(0)
  createdAt DateTime @default(now())
}

model Wazifa {
  id          String   @id @default(cuid())
  user        User     @relation(fields: [userId], references: [id])
  userId      String
  title       String
  description String?
  target      Int?
  completed   Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Lazim {
  id          String   @id @default(cuid())
  user        User     @relation(fields: [userId], references: [id])
  userId      String
  title       String
  description String?
  frequency   String
  completed   Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model ZikrJummaContent {
  id        String   @id @default(cuid())
  title     String
  content   String
  date      DateTime
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model JournalEntry {
  id        String   @id @default(cuid())
  user      User     @relation(fields: [userId], references: [id])
  userId    String
  title     String
  content   String
  tags      String[] // Array of tags for categorization
  mood      String? // Optional mood/emotion (e.g., "grateful", "reflective", "prayerful")
  category  String? // Optional category (e.g., "reflection", "dua", "lesson", "gratitude")
  isPinned  Boolean  @default(false) // Allow users to pin important entries
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId, createdAt])
  @@index([userId, isPinned])
}

model Scholar {
  id        String           @id @default(cuid())
  name      String
  bio       String
  avatarUrl String?
  contents  ScholarContent[]
  createdAt DateTime         @default(now())
  updatedAt DateTime         @updatedAt
}

model ScholarContent {
  id              String   @id @default(cuid())
  scholar         Scholar  @relation(fields: [scholarId], references: [id])
  scholarId       String
  title           String
  body            String
  mediaUrl        String?
  backgroundColor String?  @default("#105056")
  displayOrder    Int      @default(0)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model Post {
  id        String    @id @default(cuid())
  author    User      @relation(fields: [authorId], references: [id])
  authorId  String
  content   String
  imageUrl  String?
  isHidden  Boolean   @default(false)
  comments  Comment[]
  likes     Like[]
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
}

model Comment {
  id        String   @id @default(cuid())
  post      Post     @relation(fields: [postId], references: [id])
  postId    String
  author    User     @relation(fields: [authorId], references: [id])
  authorId  String
  content   String
  createdAt DateTime @default(now())
}

model Like {
  id        String   @id @default(cuid())
  post      Post     @relation(fields: [postId], references: [id])
  postId    String
  user      User     @relation(fields: [userId], references: [id])
  userId    String
  createdAt DateTime @default(now())

  @@unique([postId, userId])
}

model ChatRoom {
  id        String           @id @default(cuid())
  name      String
  isGroup   Boolean          @default(false)
  members   ChatRoomMember[]
  messages  Message[]
  createdAt DateTime         @default(now())
}

model ChatRoomMember {
  id        String   @id @default(cuid())
  room      ChatRoom @relation(fields: [roomId], references: [id])
  roomId    String
  user      User     @relation(fields: [userId], references: [id])
  userId    String
  role      String   @default("member")
  createdAt DateTime @default(now())

  @@unique([roomId, userId])
}

model Message {
  id        String   @id @default(cuid())
  room      ChatRoom @relation(fields: [roomId], references: [id])
  roomId    String
  sender    User     @relation(fields: [senderId], references: [id])
  senderId  String
  content   String
  createdAt DateTime @default(now())
}

model Campaign {
  id          String     @id @default(cuid())
  title       String
  description String
  goalAmount  Int?
  isActive    Boolean    @default(true)
  donations   Donation[]
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
}

model Donation {
  id         String   @id @default(cuid())
  user       User?    @relation(fields: [userId], references: [id])
  userId     String?
  campaign   Campaign @relation(fields: [campaignId], references: [id])
  campaignId String
  amount     Int
  receiptUrl String?
  createdAt  DateTime @default(now())
}

model SupportTicket {
  id        String   @id @default(cuid())
  user      User?    @relation(fields: [userId], references: [id])
  userId    String?
  subject   String
  message   String
  status    String   @default("open")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ReleaseNote {
  id        String   @id @default(cuid())
  version   String
  title     String
  body      String
  createdAt DateTime @default(now())
}

model Subscriber {
  id        String   @id @default(cuid())
  email     String   @unique
  createdAt DateTime @default(now())
}

model ContactSubmission {
  id        String   @id @default(cuid())
  name      String
  email     String
  message   String
  createdAt DateTime @default(now())
}

model AppSettings {
  id              String   @id @default(cuid())
  maintenanceMode Boolean  @default(false)
  faqJson         String? // JSON string for FAQs
  makkahStreamUrl String? // Makkah live stream URL
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model AuditLog {
  id        String   @id @default(cuid())
  actor     User?    @relation(fields: [actorId], references: [id])
  actorId   String?
  action    String
  metadata  String?
  createdAt DateTime @default(now())
}

model Event {
  id          String    @id @default(cuid())
  title       String
  description String
  startDate   DateTime
  endDate     DateTime?
  location    String?
  imageUrl    String?
  isActive    Boolean   @default(true)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

model MakkahStream {
  id           String   @id @default(cuid())
  title        String
  subtitle     String
  url          String
  displayOrder Int      @default(0)
  isActive     Boolean  @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

model Notification {
  id          String             @id @default(cuid())
  title       String
  message     String
  type        String             @default("info") // info, warning, success, error
  targetType  String // "all", "group", "individual"
  targetUsers NotificationUser[]
  isRead      Boolean            @default(false)
  createdAt   DateTime           @default(now())
  updatedAt   DateTime           @updatedAt
}

model NotificationUser {
  id             String       @id @default(cuid())
  notification   Notification @relation(fields: [notificationId], references: [id], onDelete: Cascade)
  notificationId String
  user           User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId         String
  isRead         Boolean      @default(false)
  readAt         DateTime?
  createdAt      DateTime     @default(now())

  @@unique([notificationId, userId])
}

model UserGroup {
  id          String            @id @default(cuid())
  name        String            @unique
  description String?
  users       UserGroupMember[]
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt
}

model UserGroupMember {
  id        String    @id @default(cuid())
  group     UserGroup @relation(fields: [groupId], references: [id], onDelete: Cascade)
  groupId   String
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    String
  createdAt DateTime  @default(now())

  @@unique([groupId, userId])
}
